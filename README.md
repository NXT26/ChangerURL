# ChangerURL

ChangerURL ‚Äî —ç—Ç–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π API-—Å–µ—Ä–≤–∏—Å –¥–ª—è —Å–æ–∫—Ä–∞—â–µ–Ω–∏—è —Å—Å—ã–ª–æ–∫, —Å–æ–∑–¥–∞–Ω–∏—è QR-–∫–æ–¥–æ–≤ –∏ —Å–±–æ—Ä–∞ –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤.
–ü—Ä–æ–µ–∫—Ç –ø–æ–∑–≤–æ–ª—è–µ—Ç –±—ã—Å—Ç—Ä–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–∏–µ URL, –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –∫–ª–∏–∫–æ–≤ –∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å—Å—è —Å —Å–∏—Å—Ç–µ–º–∞–º–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.

---

## üöÄ –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª

- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫ –¥–ª—è –ª—é–±—ã—Ö URL.
- –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ –∫–æ—Ä–æ—Ç–∫–∏–º —Å—Å—ã–ª–∫–∞–º –Ω–∞ –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –∞–¥—Ä–µ—Å.
- –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–æ–≤ –ø–æ —Å—Å—ã–ª–∫–µ.
- –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è —Å—Å—ã–ª–æ–∫ (–∑–∞–ø—Ä–µ—Ç –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ).
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–æ–≤ –¥–ª—è –∫–æ—Ä–æ—Ç–∫–∏—Ö —Å—Å—ã–ª–æ–∫.
- –°–±–æ—Ä –º–µ—Ç—Ä–∏–∫ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —á–µ—Ä–µ–∑ Prometheus –∏ Grafana.
- –°–∫—Ä–∏–ø—Ç—ã –¥–ª—è —Å–∏–º—É–ª—è—Ü–∏–∏ –∫–ª–∏–∫–æ–≤ –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏.

---

## üõ†Ô∏è –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

- Python 3.9
- FastAPI ‚Äî –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π API
- SQLAlchemy (async) ‚Äî —Ä–∞–±–æ—Ç–∞ —Å PostgreSQL
- PostgreSQL ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- Alembic ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏ —Å—Ö–µ–º—ã –±–∞–∑—ã
- Prometheus ‚Äî —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫
- Grafana ‚Äî –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- Docker + Docker Compose ‚Äî –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
- pytest ‚Äî —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
ChangerURL/
‚îú‚îÄ‚îÄ app/                  # –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ crud.py           # –û–ø–µ—Ä–∞—Ü–∏–∏ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ models.py         # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ routes.py         # –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ db.py             # –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ
‚îÇ   ‚îú‚îÄ‚îÄ main.py           # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ metrics.py        # –ú–µ—Ç—Ä–∏–∫–∏ Prometheus
‚îÇ   ‚îî‚îÄ‚îÄ schemas.py        # Pydantic —Å—Ö–µ–º—ã
‚îÇ
‚îú‚îÄ‚îÄ alembic/              # –ú–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ tests/                # –¢–µ—Å—Ç—ã –Ω–∞ pytest
‚îú‚îÄ‚îÄ data/                 # –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
‚îú‚îÄ‚îÄ simulate_clicks.py    # –°–∫—Ä–∏–ø—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–ª–∏–∫–æ–≤
‚îú‚îÄ‚îÄ populate_test_data.py # –°–∫—Ä–∏–ø—Ç —Å–æ–∑–¥–∞–Ω–∏—è —Ç–µ—Å—Ç–æ–≤—ã—Ö —Å—Å—ã–ª–æ–∫
‚îú‚îÄ‚îÄ docker-compose.yml    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è docker-compose
‚îú‚îÄ‚îÄ Dockerfile            # Dockerfile –¥–ª—è —Å–±–æ—Ä–∫–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
‚îú‚îÄ‚îÄ requirements.txt      # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ prometheus.yml        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus
‚îú‚îÄ‚îÄ alembic.ini           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Alembic
‚îî‚îÄ‚îÄ .env                  # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```

---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker

### 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è

```bash
git clone https://github.com/NXT26/ChangerURL.git
cd ChangerURL
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –ø—Ä–∏–º–µ—Ä–∞:

```bash
POSTGRES_HOST=postgres
POSTGRES_PORT=port
POSTGRES_DB=db
POSTGRES_USER=postgres
POSTGRES_PASSWORD=your_password
```

(–µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ Docker Compose ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–º–µ–Ω–Ω–æ `POSTGRES_HOST=postgres`)

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
docker compose up --build
```

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å—ã –±—É–¥—É—Ç –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å–∞–º:

| –°–µ—Ä–≤–∏—Å | –ê–¥—Ä–µ—Å |
|:---|:---|
| FastAPI API | http://localhost:8000 |
| Swagger UI | http://localhost:8000/docs |
| Prometheus | http://localhost:9090 |
| Grafana | http://localhost:3001 |

**–î–æ—Å—Ç—É–ø –≤ Grafana:**
- –õ–æ–≥–∏–Ω: `admin`
- –ü–∞—Ä–æ–ª—å: `admin`

---

## üìã –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ API

### Swagger UI
–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –¥–æ—Å—Ç—É–ø–Ω–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:
üëâ http://localhost:8000/docs

### –û—Å–Ω–æ–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

| –ú–µ—Ç–æ–¥ | –ü—É—Ç—å | –û–ø–∏—Å–∞–Ω–∏–µ |
|:-----:|:-----|:---------|
| `POST` | `/shorten` | –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ |
| `GET` | `/{short_code}` | –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–µ |
| `GET` | `/stats/{short_code}` | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ —Å—Å—ã–ª–∫–µ |
| `POST` | `/deactivate/{short_code}` | –î–µ–∞–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ—Ä–æ—Ç–∫–æ–π —Å—Å—ã–ª–∫–∏ |
| `GET` | `/qr/{short_code}` | –ì–µ–Ω–µ—Ä–∞—Ü–∏—è QR-–∫–æ–¥–∞ –¥–ª—è —Å—Å—ã–ª–∫–∏ |

---

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –º–µ—Ç—Ä–∏–∫–∏

–ú–µ—Ç—Ä–∏–∫–∏ Prometheus –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ –∞–¥—Ä–µ—Å—É:
üëâ http://localhost:8000/metrics

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –≤ Grafana

–ü–æ–¥–∫–ª—é—á–∏—Ç–µ –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö Prometheus —á–µ—Ä–µ–∑ URL:
```
http://prometheus:9090
```

### –ü—Ä–∏–º–µ—Ä—ã –≥—Ä–∞—Ñ–∏–∫–æ–≤:

| –ù–∞–∑–≤–∞–Ω–∏–µ | –ó–∞–ø—Ä–æ—Å |
|:---|:---|
| –ó–∞–ø—Ä–æ—Å—ã –ø–æ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞–º | `sum(rate(http_requests_total[1m])) by (handler)` |
| –û—à–∏–±–∫–∏ 4xx | `sum(rate(http_requests_total{status=~"4.."}[1m])) by (handler)` |
| –î–æ–ª–∏ —Å—Ç–∞—Ç—É—Å–æ–≤ | `sum(rate(http_requests_total[5m])) by (status)` |
| –°—Ä–µ–¥–Ω–µ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ | `rate(http_server_requests_duration_seconds_sum[5m]) / rate(http_server_requests_duration_seconds_count[5m])` |
| 95-–π –ø–µ—Ä—Ü–µ–Ω—Ç–∏–ª—å –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞ | `histogram_quantile(0.95, sum(rate(http_server_requests_duration_seconds_bucket[5m])) by (le))` |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤:

```bash
pytest tests/
```

(–≤ —Ç–µ—Å—Ç–∞—Ö –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–∞—è –±–∞–∑–∞ –∏ —Ñ–µ–π–∫–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ)

---

## üì∏ –ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–∞ Grafana

<img width="1169" alt="–°–Ω–∏–º–æ–∫ —ç–∫—Ä–∞–Ω–∞ 2025-04-27 –≤ 13 13 30" src="https://github.com/user-attachments/assets/6bcec558-5eae-4948-bcfc-502dd3ef1ef4" />

---

## üì¢ –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ

- –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ –º–∏–≥—Ä–∏—Ä—É–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
- –í—Å–µ –º–µ—Ç—Ä–∏–∫–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–±–∏—Ä–∞—é—Ç—Å—è –∏ –¥–æ—Å—Ç—É–ø–Ω—ã –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å—Ä–∞–∑—É –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞.

---

## üß† –ö–æ–Ω—Ç–∞–∫—Ç—ã

–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫: [NXT26](https://github.com/NXT26)

---

> –ü—Ä–æ–µ–∫—Ç –∞–∫—Ç–∏–≤–Ω–æ —Ä–∞–∑–≤–∏–≤–∞–µ—Ç—Å—è –∏ –æ—Ç–∫—Ä—ã—Ç –¥–ª—è —É–ª—É—á—à–µ–Ω–∏–π üöÄ


